# 前端規格（Front-end Spec）

> **技術實作參考**：詳細的 Telegram API 規格、webhook 設定、訊息範本請參閱 [spec.md](./spec.md)

## 1. 流程與互動

### 訂閱確認流程

用戶與 Bot 的完整互動流程：

1. **開始互動**：用戶發送 `/start` 或「開始」給 Bot
2. **查看狀態**：Bot 回覆目前訂閱狀態與可用指令
3. **發起訂閱**：用戶發送「訂閱」或 `/subscribe`
4. **Token 確認**：Bot 回覆確認 token，提示用戶輸入「確認 <token>」
5. **完成訂閱**：用戶輸入「確認 <token>」後，Bot 回覆訂閱啟用
6. **管理訂閱**：用戶可隨時輸入「退訂」或 `/unsubscribe` 取消訂閱
7. **查詢狀態**：用戶可輸入「狀態」或 `/status` 查詢目前狀態

### 群組互動特殊規則

- 群組內僅接受管理員指令，Bot 需驗證管理員身份
- 群組訂閱流程與私聊相同，但所有指令需由管理員發出
- 詳細關鍵字處理與 Token 驗證邏輯請參閱 [spec.md - 訂閱與確認流程](./spec.md#7-訂閱與確認流程)

## 2. 訊息設計與 UX

### 介面原則

- 所有互動皆以 Telegram Bot 訊息為主，無額外網頁介面
- Bot 訊息需簡潔明確，指令與回覆皆以繁體中文為主
- 訂閱流程需明確提示每一步，避免誤操作
- 失敗或錯誤時，Bot 需回覆原因與後續指引

### 標準訊息範本

**設計原則**：

- Bot 訊息需簡潔明確，提供清楚的操作指引
- 所有系統回應皆以繁體中文為主
- 錯誤或失敗時需提供原因與後續指引

**主要回應類型**：

- 訂閱流程回應：引導用戶完成確認
- 狀態查詢回應：顯示目前訂閱狀態與設定
- 推播訊息：新聞內容的格式化顯示

詳細訊息範本與格式請參閱 [spec.md - 訊息範本](./spec.md#73-訊息範本確認用與互動回應) 與 [spec.md - Telegram 訊息格式](./spec.md#9-telegram-訊息格式)

### 時間格式與顯示

- 所有日期顯示皆為 YYYY-MM-DD（Asia/Taipei 時區）
- 推播時間、確認時間等皆依台灣時區顯示
- 詳細時區處理邏輯請參閱 [spec.md - 時區與日期](./spec.md#3-時區與日期)

## 3. 使用者體驗

### UX 設計原則

- 訂閱流程需明確提示每一步，避免誤操作
- 失敗或錯誤時，Bot 需回覆原因與後續指引
- 支援多用戶、多群組同時互動
- Token 確認有時效性（10 分鐘），逾期需重新申請

### 互動限制與考量

- 所有互動皆需考慮 Telegram API 速率限制，避免訊息延遲或失敗
- Bot 需支援繁體中文訊息與指令
- 群組管理員身份驗證，防止非授權訂閱

詳細人機互動範例請參閱 [spec.md - 人機互動流程](./spec.md#75-人機互動流程範例)

## 4. 詳細互動場景

### 4.1 新用戶首次使用流程

**場景**：新用戶第一次與 Bot 互動

1. **用戶**：發送 `/start`
2. **Bot 回應**：

   ```
   🤖 歡迎使用新聞推播 Bot！

   目前狀態：未訂閱

   可用指令：
   📝 訂閱 - 開始接收新聞推播
   📊 狀態 - 查看訂閱狀態
   ❓ 說明 - 查看詳細說明
   ```

3. **用戶**：發送「訂閱」
4. **Bot 回應**：

   ```
   📝 訂閱確認流程已開始

   請輸入以下確認指令：
   確認 abc123def

   ⏰ 此確認碼將於 10 分鐘後過期
   ```

5. **用戶**：發送「確認 abc123def」
6. **Bot 回應**：

   ```
   ✅ 訂閱確認成功！

   您已成功訂閱新聞推播服務
   推播時間：每小時整點（如有新內容）

   管理指令：
   📊 狀態 - 查看訂閱狀態
   🚫 退訂 - 取消訂閱服務
   ```

### 4.2 已訂閱用戶管理流程

**場景**：已確認訂閱的用戶查詢狀態

1. **用戶**：發送「狀態」
2. **Bot 回應**：

   ```
   📊 訂閱狀態資訊

   狀態：✅ 已訂閱
   訂閱時間：2025-08-14 15:30
   確認時間：2025-08-14 15:32

   推播設定：
   🌍 全部新聞來源
   📅 每日推播（如有新內容）

   管理選項：
   🚫 退訂 - 取消訂閱服務
   ```

### 4.3 錯誤處理與用戶指引

**場景 1**：Token 過期

1. **用戶**：發送「確認 expired123」（過期 token）
2. **Bot 回應**：

   ```
   ❌ 確認碼已過期或無效

   請重新開始訂閱流程：
   1. 發送「訂閱」取得新的確認碼
   2. 在 10 分鐘內完成確認

   如需協助，請發送「說明」查看詳細指引
   ```

**場景 2**：重複訂閱

1. **用戶**：已確認用戶再次發送「訂閱」
2. **Bot 回應**：

   ```
   ℹ️ 您已經是訂閱用戶

   目前狀態：✅ 已訂閱
   訂閱時間：2025-08-14 15:30

   如需管理訂閱：
   📊 狀態 - 查看詳細資訊
   🚫 退訂 - 取消訂閱服務
   ```

### 4.4 群組管理特殊場景

**場景**：非管理員嘗試在群組中訂閱

1. **一般用戶**：在群組中發送「訂閱」
2. **Bot 回應**：

   ```
   🔒 群組訂閱需要管理員權限

   請請群組管理員執行以下操作：
   1. 管理員發送「訂閱」指令
   2. 完成確認流程

   或您可以私訊 Bot 進行個人訂閱
   ```

## 5. 推播訊息格式規範

### 5.1 標準推播訊息格式

```
📰 新聞推播

<b>標題</b>：文章標題內容
📅 日期：2025-08-14
👤 來源：username

內容摘要部分，簡潔扼要地描述新聞重點...

🔗 <a href="https://example.com/news/1">閱讀完整內容</a>

---
💡 回覆「狀態」查看訂閱資訊｜回覆「退訂」取消推播
```

### 5.2 批量推播處理

- 多篇新聞時間間隔：每個用戶最少 1 秒間隔
- 長內容自動截斷：超過 3800 字符時加上「...」
- HTML 格式化：粗體、連結、換行正確處理

### 5.3 推播失敗處理

**用戶端顯示**：用戶不會看到失敗訊息，系統自動重試
**管理端記錄**：失敗原因記錄到資料庫供分析
**重試邏輯**：指數退避，最多重試 3 次

## 6. 可訪問性與國際化

### 6.1 語言支援

- **主要語言**：繁體中文
- **指令支援**：中文與英文指令並存（如「訂閱」與 `/subscribe`）
- **時區顯示**：統一使用台灣時區（Asia/Taipei）

### 6.2 用戶友善設計

- **清晰的狀態提示**：每個操作都有明確的成功/失敗回饋
- **操作引導**：錯誤時提供明確的下一步指引
- **快速操作**：常用功能一鍵完成（如狀態查詢）

### 6.3 無障礙考量

- **訊息結構化**：使用 emoji 和分隔線提高可讀性
- **指令多樣化**：支援多種表達方式（如「狀態」、「status」、「查詢」）
- **錯誤容忍**：對常見輸入錯誤有一定容忍度
